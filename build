#!/bin/sh
#Dependencies: Stopify Racketscript (Racks) NPM Node
RACKSOUT='js-build'
SRC="$RACKSOUT/modules/"
STOPDIR="node_modules/.bin/stopify"
STOPOUT="stopped.js"

echo "Building $1 to $1_stopped.js"

#run racks
racks -bd $RACKSOUT $1

#install node packages
npm install

#run rollup with babel
rollup "$SRC/$1.js" -o bundle.js -f cjs --config rollup.config.js

#use stopify
$STOPDIR --require-runtime bundle.js $STOPOUT

#beautify the results
js-beautify -r $STOPOUT

#
node "stopped.js"